@page
@model IndexModel
@{
    ViewData["Title"] = "Index";
}

<style>
    .before {
        grid-area: before;
    }

    .after {
        grid-area: after;
    }

    .submit {
        grid-area: submit;
    }

    .computed {
        background-color: #EEEEEE;
        grid-area: computed;
        white-space: nowrap;
    }

    .wrapper {
        display: grid;
        grid-template-columns: 50% 50%;
        grid-auto-rows: auto;
        grid-gap: 5px;
        grid-template-areas:
            "before         after"
            "submit         ."
            "computed       computed";
    }

    .lineNumberBlock {
        color: #888888;
        text-align: center;
    }

    .deleteBlock {
        background-color: #FFAAAA;
    }

    .insertBlock {
        background-color: #AAFFAA;
    }

    .deleteLine {
        background-color: #FFDDDD;
    }

    .insertLine {
        background-color: #DDFFDD;
    }

    .column {
        display: flex;
    }
</style>

<form method="post" class="column">
    <div class="wrapper">
        <div class="before"><textarea id="before" name="before" rows="20" cols="100">@Model.Before</textarea></div>
        <div class="after"><textarea id="after" name="after" rows="20" cols="100">@Model.After</textarea></div>
        <div class="submit" value="Compute"><input type="submit" /></div>
        <table class="computed">
            @for (int i = 0, beforeIndex = 0, afterIndex = 0; i < Model.Highlighted.Length; ++i)
            {
            <tr>
                @if (Model.Highlighted[i].Before != null)
                {
                    beforeIndex += 1;
                    <td class="lineNumberBlock">@beforeIndex</td>
                    <td class="@(Model.Highlighted[i].Before.Count > 1 ? "deleteLine":"")">
                            @for (var b = 0; b < Model.Highlighted[i].Before.Count; ++b)
                            {
                                @if (b % 2 == 0)
                                {<span class="">@Model.Highlighted[i].Before[b]</span>}
                                else
                                {<span class="deleteBlock">@Model.Highlighted[i].Before[b]</span>}
                            }
                    </td>
                }
                else
                {
                    <td></td>
                    <td></td>
                }
                @if (Model.Highlighted[i].After != null)
                {
                    afterIndex += 1;
                    <td class="lineNumberBlock">@afterIndex</td>
                    <td class="@(Model.Highlighted[i].After.Count > 1 ? "insertLine":"")">
                            @for (var b = 0; b < Model.Highlighted[i].After.Count; ++b)
                            {
                                @if (b % 2 == 0)
                                {<span class="">@Model.Highlighted[i].After[b]</span>}
                                else
                                {<span class="insertBlock">@Model.Highlighted[i].After[b]</span>}
                            }
                    </td>
                }
                else
                {
                    <td></td>
                    <td></td>
                }
            </tr>
            }
        </table>
    </div>
</form>

